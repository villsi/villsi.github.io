<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.124.1"><title>Front End | 上海红茶馆</title>
<meta name=author content="我喜欢煎蛋卷"><meta name=keywords content><meta name=description content="前端应用笔记，包括前端安全、性能优化、移动兼容等内容。"><link rel=preconnect href=https://cdn.jsdelivr.net><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=icon href=https://img.villsi.net/2024/02/406ea82c745c86ed884654e18edda6a0.png sizes=any><link rel=icon sizes=192x192 href=https://img.villsi.net/2024/02/406ea82c745c86ed884654e18edda6a0.png><link rel=icon sizes=512x512 href=https://img.villsi.net/2024/02/406ea82c745c86ed884654e18edda6a0.png><link rel=apple-touch-icon sizes=180x180 href=https://img.villsi.net/2024/02/406ea82c745c86ed884654e18edda6a0.png><meta property="og:title" content="Front End | 上海红茶馆"><meta name=twitter:title content="Front End | 上海红茶馆"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.villsi.net/code/front-end/"><meta property="og:description" content="前端应用笔记，包括前端安全、性能优化、移动兼容等内容。"><meta name=twitter:description content="前端应用笔记，包括前端安全、性能优化、移动兼容等内容。"><meta property="og:image" content="https://img.villsi.net/2023/12/fd029546dac00eb0a7db2781444cb6c2.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://img.villsi.net/2023/12/fd029546dac00eb0a7db2781444cb6c2.jpg"><meta property="article:published_time" content="2019-09-07T23:00:01+08:00"><meta property="article:modified_time" content="2024-04-01T10:02:41+08:00"><link rel=alternate type=application/atom+xml href=https://blog.villsi.net/index.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css><link rel=stylesheet href=https://blog.villsi.net/assets/main.min.css><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js></script><script defer src=https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js></script><script defer src=https://blog.villsi.net/assets/main.min.js></script></head><body data-theme=auto data-section=single><header class=header id=my-header><nav id=top-navbar class="navbar shadow-sm fixed-top navbar-expand-md navbar-white bg-white"><div class="container p-0"><a class=navbar-brand href=https://blog.villsi.net/><img src=https://img.villsi.net/2024/02/406ea82c745c86ed884654e18edda6a0.png alt=Logo width=40 height=40 class=align-middle>
<span class="d-inline align-middle ps-2">上海红茶馆</span>
</a><button class="navbar-toggler border border-0" type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-md-0 fw-normal"><li class=nav-item><a class="nav-link ms-4 text-center" href=https://blog.villsi.net/post/>文章</a></li><li class=nav-item><a class="nav-link ms-4 text-center" href=https://blog.villsi.net/archive/>归档</a></li><li class=nav-item><a class="nav-link ms-4 text-center" href=https://blog.villsi.net/tagcloud/>标签</a></li><li class=nav-item><a class="nav-link ms-4 text-center active" href=https://blog.villsi.net/code/>笔记</a></li><li class=nav-item><a class="nav-link ms-4 text-center" href=https://blog.villsi.net/echart/>关于</a></li></ul></div></div></nav></header><main class="main fix-padding-top"><div class=container><div class="row g-3"><div class="col-xl-2 col-lg-3 px-0 d-none d-lg-block"><aside class="sticky-top fix-sidebar-top"><div class=sidebar_sticky><section class="d-none d-sm-block"><div class="card border-0 card-body mb-3"><div class="pb-1 text-center"><img class="img-fluid rounded w-50" loading=lazy src=https://img.villsi.net/2023/12/fd029546dac00eb0a7db2781444cb6c2.jpg alt=头像></div><div class="pb-2 text-center"><div class=text-primary>我喜欢煎蛋卷</div><div class="text-secondary fst-italic fw-lighter small">Per aspera ad astra.</div></div><div class="pb-2 small text-center row m-0"><div class="col px-0"><div class=text-primary>308</div><div class=text-secondary>千字</div></div><div class="col px-0"><div class=text-primary>37</div><div class=text-secondary>文章</div></div><div class="col px-0"><div class=text-primary>15</div><div class=text-secondary>标签</div></div></div><div class=btn-group role=group><a class="btn btn-link link-dark p-0" href=https://github.com/villsi target=_blank rel=noopener title=GitHub><i class="bi bi-github"></i>
</a><a class="btn btn-link link-dark p-0" href=https://twitter.com/villsi target=_blank rel=noopener title=Twitter><i class="bi bi-twitter"></i>
</a><a class="btn btn-link link-dark p-0" href=https://steamcommunity.com/id/villsi/ target=_blank rel=noopener title=Steam><i class="bi bi-steam"></i></a></div></div></section><section class="d-none d-sm-block"><div class="card border-0 mb-3"><div class="card-header bg-white border-light-subtle"><span class="text-uppercase fw-medium">Categories</span></div><div class="card-body py-2"><ul class="list-group list-group-flush small"><li class="list-group-item d-flex justify-content-between align-items-center px-0 border-light-subtle"><a class="text-truncate link-underline-primary link-offset-0 link-underline-opacity-0 link-underline-opacity-75-hover" href=https://blog.villsi.net/categories/blog/>Blog
</a><span class="badge bg-primary rounded-pill">2</span></li><li class="list-group-item d-flex justify-content-between align-items-center px-0 border-light-subtle"><a class="text-truncate link-underline-primary link-offset-0 link-underline-opacity-0 link-underline-opacity-75-hover" href=https://blog.villsi.net/categories/uncategorized/>Uncategorized
</a><span class="badge bg-primary rounded-pill">15</span></li><li class="list-group-item d-flex justify-content-between align-items-center px-0 border-light-subtle"><a class="text-truncate link-underline-primary link-offset-0 link-underline-opacity-0 link-underline-opacity-75-hover" href=https://blog.villsi.net/categories/%E5%8D%9A%E5%AE%A2%E8%A3%85%E4%BF%AE/>博客装修
</a><span class="badge bg-primary rounded-pill">1</span></li><li class="list-group-item d-flex justify-content-between align-items-center px-0 border-light-subtle"><a class="text-truncate link-underline-primary link-offset-0 link-underline-opacity-0 link-underline-opacity-75-hover" href=https://blog.villsi.net/categories/%E8%B7%91%E5%9B%A2%E8%AE%B0%E5%BD%95/>跑团记录
</a><span class="badge bg-primary rounded-pill">10</span></li></ul></div></div></section><section class="d-none d-sm-block"><div class="card border-0 mb-3"><div class="card-header bg-white border-light-subtle"><span class="text-uppercase fw-medium">Tag Cloud</span></div><div class=card-body><div class=grid><a href=https://blog.villsi.net/tags/blog/ title=Blog class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">Blog</span>
</a><a href=https://blog.villsi.net/tags/cloudflare/ title=Cloudflare class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">Cloudflare</span>
</a><a href=https://blog.villsi.net/tags/deep-learning/ title="Deep Learning" class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">Deep Learning</span>
</a><a href=https://blog.villsi.net/tags/dnn/ title=DNN class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">DNN</span>
</a><a href=https://blog.villsi.net/tags/game/ title=Game class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">Game</span>
</a><a href=https://blog.villsi.net/tags/github/ title=GitHub class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">GitHub</span>
</a><a href=https://blog.villsi.net/tags/katex/ title=Katex class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">Katex</span>
</a><a href=https://blog.villsi.net/tags/markdown/ title=Markdown class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">Markdown</span>
</a><a href=https://blog.villsi.net/tags/obsidian/ title=Obsidian class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">Obsidian</span>
</a><a href=https://blog.villsi.net/tags/programming/ title=Programming class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">Programming</span>
</a><a href=https://blog.villsi.net/tags/trpg/ title=TRPG class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">TRPG</span>
</a><a href=https://blog.villsi.net/tags/typora/ title=Typora class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">Typora</span>
</a><a href=https://blog.villsi.net/tags/%E5%86%B0%E9%A3%8E%E8%B0%B7/ title=冰风谷 class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">冰风谷</span>
</a><a href=https://blog.villsi.net/tags/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/ title=经验总结 class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">经验总结</span>
</a><a href=https://blog.villsi.net/tags/%E9%9A%8F%E6%89%8B%E6%91%98%E5%BD%95/ title=随手摘录 class="btn btn-sm btn-outline-primary py-0 my-1"><span class="d-flex text-uppercase fw-light small">随手摘录</span></a></div></div></div></section></aside></div><div class="col-xl-8 col-lg-9 px-3"><div class=content><div class="card mb-3 border-0 overflow-hidden"><div class=header-image><div class="ratio ratio-21x9 overflow-hidden bg-black"><a href=https://blog.villsi.net/code/front-end/><img class="card-img-top opacity-50" loading=lazy src=https://blog.villsi.net/code/front-end/index.webp alt=博客文章头图></a><div class="card-img-overlay row align-items-center"><div class="text-light text-center"><h2>Front End</h2><div><div class="d-block small"><div class="d-inline pe-3"><i class="bi bi-calendar3 pe-2"></i><time>2019-09-07</time></div><div class="d-inline pe-3"><i class="bi bi-book pe-1"></i>
<span>1584 字</span></div><div class=d-inline><i class="bi bi-alarm pe-1"></i>
<span>4 分钟</span></div></div><div class="d-none d-xl-block small"></div></div></div></div></div></div><article class="card-body markdown-body"><h2 id=csrf-和-xss-攻击>CSRF 和 XSS 攻击</h2><h3 id=csrf-跨站请求伪造>CSRF 跨站请求伪造</h3><ol><li>用户访问并登陆 <code>a.org</code></li><li><code>a.org</code> 生成并返回 Cookie 给用户</li><li>用户访问 <code>b.org</code>，其中有指向 <code>a.org</code> 的图片、链接和表单等</li><li>授权 Cookie 被发送给 <code>a.org</code>，造成影响</li></ol><p>防御方法：</p><ol><li>简易：Referrer 检查 (不可靠)</li><li>服务端生成并保存 Token，写入 DOM，客户端发起请求时携带</li><li>服务端生成 Token 不保存，写入 DOM 和 Cookie，客户端请求时携带二者，服务端比对</li><li>客户端生成 Token，写入 DOM 和 Cookie，请求时携带二者，服务端比对</li></ol><p>JWT (一旦签发过期前永远有效)：</p><ol><li>服务器认证后，返回含有用户信息的 JSON 对象</li><li>客户端每次请求都发送该对象用于验证</li></ol><h3 id=xss-跨站脚本>XSS 跨站脚本</h3><p>利用对用户输入没有限制的漏洞，获取到跨站脚本，在脚本中发起带有 Cookie 的请求给恶意站点。</p><h3 id=相关-cookie-字段>相关 Cookie 字段</h3><ul><li>SameSite: Lax 为现代浏览器的默认值，只允许第一方链接及第三方 GET 请求；Strict 仅允许第一方；None 传统允许跨域。</li><li>HttpOnly：JS 中无法获取</li></ul><h2 id=性能优化>性能优化</h2><h3 id=指标>指标</h3><ul><li>FCP - First Contentful Paint：第一个元素被渲染</li><li>LCP - Largest Contentful Paint：可见最大元素被渲染</li><li>FID - First Input Delay：第一次交互到响应</li><li>TTI - Time to Interactive：所有元素被加载完成</li><li>TBT - Total Blocking Time：FCP 到 TTI 之间阻塞时间的总长</li></ul><h3 id=网络>网络</h3><ol><li>减少 HTTP 请求：合并资源文件，小图片内联，雪碧图 (<code>background-position</code>) 等 (这里暂不考虑 HTTP/2)</li><li>减小资源体积：gzip (服务器) ，webp 图片 (<code>picture</code> 和 <code>srcset</code>)</li><li>缓存：CDN 缓存，HTTP 缓存 (<code>Cache-Control</code>，<code>Last-Modified</code>，<code>Etag 304</code>) ，Service Worker (拦截 HTTP 请求)</li></ol><h3 id=http2>HTTP/2</h3><ul><li>服务端推送：PUSH 方法；例如请求 <code>.html</code> 时服务端主动尝试返回 <code>.css</code> 和 <code>.js</code> 等资源</li><li>多路复用：尝试将多个 HTTP 请求合并一起发送；在 HTTP/1.1 中，<code>keep-alive</code> 可以使 TCP 连接保持打开，但数据传输依旧是 <code>请求 A => 响应 A => 请求 B => 响应 B</code> 的模式，而在 HTTP/2 中，就可以实现 <code>请求 A 和 B => 响应 A 和 B</code>；在使用 HTTP/2 的情况下，&ldquo;减少 HTTP 请求&rdquo; 这类的性能优化并不一定在所有情况下都能有效</li><li>首部压缩：HTTP 头压缩和复用等</li><li>二进制分帧：将信息分割为更小的帧，并对它们采用二进制编码，其中例如 HTTP 头会被封装到 Headers 帧</li></ul><h3 id=dom-与渲染>DOM 与渲染</h3><ol><li>基础内容：头部 CSS (异步) ，JS 的 <code>async</code> 与 <code>defer</code></li><li>DOM 操作：减少大规模 DOM 操作，使用 class 修改样式，使用 CSS 动画和 <code>requestAnimationFrame</code></li><li>事件代理：列表内每个元素设置一个事件 vs 整个列表设置事件 (可冒泡)</li></ol><h2 id=移动-web-开发>移动 Web 开发</h2><h3 id=兼容>兼容</h3><p>移动端浏览器的碎片化比桌面端严重，设备之间的差距也很大，很多系统内置 WebView 的更新不及时，因此要注意新特性的兼容。</p><p>个人使用 Modernizr 检测兼容性问题，视情况引入 polyfill；原生新特性可以利用 Babel 转译。</p><h3 id=性能>性能</h3><p>移动端性能相对来说一定是较差的，不仅仅针对于移动端，类似减少大规模 DOM 操作、小图片的 base64 内联和 lazyload 之类都是有效果的。</p><h3 id=像素>像素</h3><ul><li>px：CSS 内的 px，浏览器使用的单位 (例如：320x568)</li><li>物理像素：设备屏幕本身像素 (例如：640x1136)</li><li>DPR：设备像素缩放比 (1px = DPR^2 x dp，例如当 DPR=2 时，一个 CSS 像素等于四个物理像素)</li></ul><p>因此在这种情况下，直接指定 1px CSS 边框实际是 2px 物理像素的边框。</p><ul><li>PPI：一般单位英寸像素密度较高</li></ul><p>同时，各个设备的 viewport 定义一般不同，因此一般手动指定 viewport 宽度为设备宽度：</p><pre><code class=language-html>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
</code></pre><p>两种设计模式：</p><ol><li>直接根据计算出的 CSS 像素进行设计，比如上文的 320x568</li><li>DPR=2，缩放比设为 0.5，根据设备物理像素进行设计</li></ol><p>对于边框问题：</p><ol><li>利用 CSS Media Query 检查 <code>-webkit-min-device-pixel-ratio</code>，设置小数边框 (兼容性问题)</li><li>利用 JS 检查 DPR 动态设置 viewport meta 头里的缩放 (<code>initial-scale</code>) 和根元素上的字体大小；这个方案需要全局使用 rem 单位，适合新项目</li><li>利用图片，<code>border-image</code> 或 <code>background-image</code></li><li><code>transform: scale(0.5)</code>，比例利用 CSS Media Query 检查</li></ol><h3 id=交互>交互</h3><p>为了触屏操作而产生的 300 毫秒问题，普通网页一般没事，但要有 APP 体验的话需要解决。</p><p>使用 <code>touch</code> (<code>start</code>、<code>move</code>、<code>end</code>、<code>cancel</code>) 相关事件代替 <code>click</code>，注意点击穿透问题，A 上面的 B 元素 <code>touchstart</code> 触发后，若 A 消失则 B 的 <code>click</code> 会被触发。</p><p>弹性滚动：</p><pre><code class=language-css>div {
  -webkit-overflow-scrolling: touch;
}
</code></pre></article></div><div class="card card-body mb-3 border-0 markdown-body"><blockquote class=mb-0>本站内容采用 CC BY-NC-SA 4.0 许可，请注明出处；商业转载请联系作者授权。</blockquote></div><div class="card card-body border-0"><script async crossorigin=anonymous src=https://giscus.app/client.js data-repo=villsi/villsi.github.io data-repo-id=R_kgDOLG5awg data-category=Announcements data-category-id=DIC_kwDOLG5aws4CcvEE data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=noborder_light data-lang=zh-CN data-loading=lazy></script></div></div></div><div class="col-xl-2 col-lg-0 col-md-0 px-0 d-none d-xl-block"><aside class="sticky-top fix-sidebar-top"><section class="d-none d-sm-block"><div class="card border-0 mb-3"><div class="card-header bg-white d-flex justify-content-center border-light-subtle"><span class="text-uppercase fw-medium">This Page</span></div><div class="card-body small"><nav id=TableOfContents><ul><li><a href=#csrf-和-xss-攻击>CSRF 和 XSS 攻击</a><ul><li><a href=#csrf-跨站请求伪造>CSRF 跨站请求伪造</a></li><li><a href=#xss-跨站脚本>XSS 跨站脚本</a></li><li><a href=#相关-cookie-字段>相关 Cookie 字段</a></li></ul></li><li><a href=#性能优化>性能优化</a><ul><li><a href=#指标>指标</a></li><li><a href=#网络>网络</a></li><li><a href=#http2>HTTP/2</a></li><li><a href=#dom-与渲染>DOM 与渲染</a></li></ul></li><li><a href=#移动-web-开发>移动 Web 开发</a><ul><li><a href=#兼容>兼容</a></li><li><a href=#性能>性能</a></li><li><a href=#像素>像素</a></li><li><a href=#交互>交互</a></li></ul></li></ul></nav></div></div><script src=https://cdn.jsdelivr.net/npm/gumshoejs@5.1.2/dist/gumshoe.min.js></script><script>var header=document.querySelector("#my-header"),spy=new Gumshoe("#TableOfContents a",{reflow:!0,nested:!0,nestedClass:"active",offset:function(){return header.getBoundingClientRect().height}})</script></section><section class="d-none d-sm-block"></section></aside></div></div></div></main><footer class="footer pt-4"><nav class="navbar navbar-expand-lg navbar-dark"><div class="container fw-light small my-2"><div class=navbar-text>Copyright &copy; 2018 - 2024
<a class="text-reset text-decoration-none" href target=_blank rel=noopener>上海红茶馆
</a>|
<a class="text-reset text-decoration-none" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></div><div class="navbar-text ms-auto"><a class="text-reset text-decoration-none" href=https://github.com/villsi/ target=_blank rel=noopener>Power by Cloudflare Page</a></div></div><div id=jsi-flying-fish-container class=fish_jump></div></nav><button button type=button class="btn btn-dark btn-sm scrollupBtn" title=返回顶部>
<i class="bi bi-chevron-up"></i></button></footer></body></html>