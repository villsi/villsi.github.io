<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.121.2"><link rel=preconnect href=https://cdn.jsdelivr.net><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@300;400;500&family=Noto+Sans+SC:wght@300;400;500&family=Noto+Sans+JP:wght@300;400;500&family=Fira+Code:wght@300;400;500"><title>Vue.js | 上海红茶馆</title>
<meta name=author content="我喜欢煎蛋卷"><meta name=description content="Vue.js 重点整理，包括一些框架特定的内容、特性，以及与其他框架的对比等。"><link rel=icon href=https://img.villsi.net/2023/12/efabaf2039214b5692c50465a865f8c1.webp sizes=any><link rel=icon sizes=192x192 href=https://img.villsi.net/2023/12/efabaf2039214b5692c50465a865f8c1.webp><link rel=icon sizes=512x512 href=https://img.villsi.net/2023/12/efabaf2039214b5692c50465a865f8c1.webp><link rel=apple-touch-icon sizes=180x180 href=https://img.villsi.net/2023/12/efabaf2039214b5692c50465a865f8c1.webp><meta property="og:title" content="Vue.js | 上海红茶馆"><meta name=twitter:title content="Vue.js | 上海红茶馆"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.villsi.net/code/vuejs/"><meta property="og:description" content="Vue.js 重点整理，包括一些框架特定的内容、特性，以及与其他框架的对比等。"><meta name=twitter:description content="Vue.js 重点整理，包括一些框架特定的内容、特性，以及与其他框架的对比等。"><meta property="og:image" content="https://img.villsi.net/2023/12/fd029546dac00eb0a7db2781444cb6c2.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://img.villsi.net/2023/12/fd029546dac00eb0a7db2781444cb6c2.jpg"><meta property="article:published_time" content="2020-09-11T11:11:11+08:00"><meta property="article:modified_time" content="2024-01-24T16:08:39+08:00"><link rel=alternate type=application/atom+xml href=https://blog.villsi.net/index.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css><link rel=stylesheet href=https://blog.villsi.net/assets/main.min.css><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js></script><script defer src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js></script><script defer src=https://blog.villsi.net/assets/main.min.js></script></head><body data-theme=auto data-section=single><header class="header shadow-sm"><nav class="navbar container"><div class=navbar__brand><a class="link-underline link-underline-opacity-0 navbar__item" href=https://blog.villsi.net><h1>上海红茶馆</h1></a></div><div class=navbar__menu><div class=navbar__start><a class="link-underline link-underline-opacity-0 navbar__item" href=https://blog.villsi.net/post/>文章</a><a class="link-underline link-underline-opacity-0 navbar__item" href=https://blog.villsi.net/tagcloud/>标签</a><a class="link-underline link-underline-opacity-0 navbar__item navbar__item--active" href=https://blog.villsi.net/code/>笔记</a><a class="link-underline link-underline-opacity-0 navbar__item" href=https://blog.villsi.net/friends/>友链</a><a class="link-underline link-underline-opacity-0 navbar__item" href=https://blog.villsi.net/echart/>关于</a><a class="link-underline link-underline-opacity-0 navbar__item" href=https://blog.villsi.net/playlist/>番剧</a></div><div class="navbar__end d-none d-lg-block"><div class=navbar__hitokoto><div id=hitokoto><a href=# id=hitokoto_text>:D 获取中...</a></div><script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script></div></div></nav></header><main class=main><div class=container><div class="row g-3"><div class=col-lg-9><div class=content><div class=header-image><div class="post__image ratio ratio-21x9"><div class=image-overlay></div><a href=https://blog.villsi.net/code/vuejs/><img class="img-fluid mx-auto d-block" loading=lazy src=https://blog.villsi.net/code/vuejs/index.webp alt=博客文章头图></a></div><div class="post__title text-truncate"><h1>Vue.js</h1><div class="single-meta flex-layout"><div class="justify-content-between meta"><div class=meta__left><span class=meta__catrgory></span><span class=meta__date><i class="bi bi-calendar3"></i>
<span><time>2020-09-11</time></span>
</span><span class="meta__words d-none d-sm-inline"><i class="bi bi-book"></i>
<span>1248 字</span>
</span><span class="meta__minutes d-none d-md-inline"><i class="bi bi-alarm"></i>
<span>3 分钟</span></span></div><div class="meta__right d-none d-xl-block"><span class=meta__tags></span></div></div></div></div></div><div class="card post"><div class=post__content><article class="card-body markdown"><h2 id=mvc-与-mvvm>MVC 与 MVVM</h2><p>MVC：</p><ol><li>View 把操作转移到 Controller 处理</li><li>Controller 完成业务逻辑后，要求 Model 改变状态</li><li>Controller 通知 Model 将新的数据发送到 View</li></ol><p>MVVM：</p><ol><li>View 把操作转移到 VM 处理</li><li>VM 完成业务逻辑后，要求 Model 改变状态</li><li>VM 与 View 双向绑定，VM 更新自动反映在 View 上</li></ol><h2 id=vdom>VDOM</h2><p>通过 JS 对象模拟庞大繁杂的 DOM 节点，通过特定的 render 方法将其渲染为实际的 DOM 元素。</p><p>Diff 算法指的是通过 VDOM 节点的比较得到 patch 对象，解析并更新需要更新的实际 DOM 元素；对于两棵树传统的 Diff 算法时间复杂度为 O(n^3)，VDOM 的算法中一般通过同级比较来简化。</p><p>Vue 中 diff 过程：</p><ol><li>首先比较两个节点是否可以视为同一个，根据 key 和 selector 判断</li><li>若不同，则直接替换结点，例如 classname 不同</li><li>若相同，则对比这两个结点</li><li>文本不同则更新文本</li><li>一方有节点则进行子结点的增删</li><li>两方都有结点则进行子结点对比，此过程 Vue 使用双向判断</li></ol><h2 id=组件通信>组件通信</h2><ul><li><code>props</code> &lt;=> <code>$emit</code></li><li><code>$parent</code> &lt;=> <code>$children</code> (不建议)</li><li><code>provide</code> &lt;=> <code>inject</code></li><li>Vuex<ul><li>State</li><li>Getters: 计算属性</li><li>Mutations: 同步</li><li>Actions: 异步</li></ul></li></ul><h2 id=响应式原理>响应式原理</h2><h3 id=vue-2>Vue 2</h3><p>当一个普通的对象转为响应式对象时，Vue 通过 <code>Object.defineProperty</code> 将其属性转为 getter 和 setter；当通过数据渲染组件时，watcher 会记录下依赖的数据；当数据改变，watcher 通知视图更新。</p><p>无法检测对象属性的添加、直接利用索引添加数组元素、改变数组长度等；解决方案为包裹数组方法和利用 <code>$set</code> 手动派发更新。</p><h3 id=vue-3>Vue 3</h3><p>同样是监听数据变化，Vue 3 使用 Proxy 拦截对所包括的响应式对象的操作，因此可以检测 Vue 2 中无法直接监测到的变化。</p><pre><code class=language-js>const dinner = {
  meal: 'tacos',
};
const handler = {
  get(target, prop, receiver) {
  track(target, prop); // 跟踪更改它的函数
  return Reflect.get(...arguments);
  },
  set(target, key, value, receiver) {
  trigger(target, key); // 触发函数以便它可以更新最终值
  return Reflect.set(...arguments);
  },
};
const proxy = new Proxy(dinner, handler);
console.log(proxy.meal);
</code></pre><h3 id=proxy-和-reflect>Proxy 和 Reflect</h3><p>Proxy 用于将一个对象包装起来并拦截对其的操作。</p><p>Reflect 是一个用于简化 Proxy 创建的对象。对于每个可被 Proxy 捕获的内部方法，在 Reflect 中都有一个对应的方法，其名称和参数与 Proxy 捕捉器相同。所以，我们可以使用 Reflect 来将操作转发给原始对象。</p><p>当某个对象继承了被 Proxy 包裹的对象时，内部函数通过 <code>this</code> 获取原型上的属性时可能会错误的被 Proxy 拦截，使用 Reflect 来避免。</p><h2 id=批量更新和-nexttick>批量更新和 nextTick</h2><p>响应式原理中提到数据改版 watcher 通知视图更新，对应的 watcher 其实是被推进类似 Event Loop 的队列，在下一个 tick 的时候将这个队列中的 watcher 全部取出并触发。<code>nextTick</code> 内部依靠 <code>Promise.then</code> 和 <code>setTimeout</code> 等原生异步队列相关的函数。</p><h2 id=router-模式>Router 模式</h2><ul><li>HASH 模式：由于 HASH 的变化浏览器可以记录，因此监听 hashchange 事件，在 HASH 中提供路径</li><li>History 模式：通过 H5 新增的两个 History API 方法 <code>pushState</code> 和 <code>replaceState</code> 不刷新页面的特性改变 URL，通过监听 popstate 事件得知页面变化，刷新和直接访问次级页面需要服务端配置</li></ul><h2 id=模板编译>模板编译</h2><ol><li>将模板字符串转换成元素的 AST 抽象语法树</li><li>优化语法树，标记静态节点</li><li>生成代码 render 函数，<code>createElement</code></li></ol><h2 id=生命周期顺序>生命周期顺序</h2><p>渲染：</p><pre><code>父 beforeCreate =&gt; 父 created =&gt; 父 beforeMount =&gt;
子 beforeCreate =&gt; 子 created =&gt; 子beforeMount =&gt;
子 mounted =&gt; 父 mounted
</code></pre><p>更新和销毁：</p><pre><code>父 beforeUpdate =&gt; 子 beforeUpdate =&gt; 子 updated =&gt; 父 updated
父 beforeDestroy =&gt; 子 beforeDestroy =&gt; 子 destroyed =&gt; 父 destroyed
</code></pre><h2 id=简化样例-observer>简化样例 Observer</h2><pre><code class=language-js>let data = {
  name: 'name',
  detail: {
  age: 12,
  },
};

let initWatcher = null;
class Watcher {
  constructor(data, key, cb) {
  this.data = date;
  this.key = key;
  this.cb = cb;
  // 触发 getter 初始化过程
  initWatcher = this;
  this.preValue = data[key];
  initWatcher = null;
  }

  update() {
  if (this.preValue !== this.data[this.key]) {
    this.cb(this.data[this.key]);
  }
  }
}

class Dependency {
  constructor() {
  this.watchers = [];
  }

  subscribe(watcher) {
  this.watchers.push(watcher);
  }

  notify() {
  this.watchers.forEach((watcher) =&gt; watcher.update());
  }
}

class Observer {
  constructor() {
  this.observe(data);
  }

  observe(data) {
  if (!data || typeof data !== 'object') {
    return;
  }
  for (let key of Object.keys(data)) {
    this.observe(data[key]);
    this.defineProp(data, key, data[key]);
  }
  }

  defineProp(obj, key, value) {
  const dep = new Dependency();
  Object.defineProperty(obj, key, {
    configurable: true,
    enumerable: true,
    get() {
    if (initWatcher) {
      dep.subscribe(initWatcher);
    }
    return value;
    },
    set(newValue) {
    this.observe(newValue);
    value = newValue;
    dep.notify();
    },
  });
  }
}
</code></pre></article></div><div class="license markdown"><blockquote>本站内容采用 CC BY-NC-SA 4.0 许可，请注明出处；商业转载请联系作者授权。</blockquote></div></div><hr><div class="card comment-area"><script async crossorigin=anonymous src=https://giscus.app/client.js data-repo=villsi/villsi.github.io data-repo-id=R_kgDOKvi-KA data-category=评论 data-category-id=DIC_kwDOKvi-KM4CbUNT data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy></script></div></div></div><div class=col-lg-3><aside class=sidebar_sticky><section><div class="card card-body mb-3 widget search"><div class=search__input><input type=text id=search-input></div><div class="search__ctrl btn btn-primary" id=search-btn title=搜索><i class="bi bi-search"></i></div></div></section><section><div class="card card-body mb-3 widget info"><div class=info__avatar><img class="img-fluid rounded mx-auto d-block" loading=lazy src=https://img.villsi.net/2023/12/fd029546dac00eb0a7db2781444cb6c2.jpg alt=头像></div><div class=info__meta><div class=info__metaName>我喜欢煎蛋卷</div><div class=info__metaWord>或许是不知梦的缘故，流离之人追逐幻影。</div></div><div class=info__counter><div class=info__counterItem><span class=info__counterData>308</span>
<span class=info__counterName>千字数</span></div><div class=info__counterItem><span class=info__counterData>36</span>
<span class=info__counterName>文章数</span></div><div class=info__counterItem><span class=info__counterData>15</span>
<span class=info__counterName>标签数</span></div></div></div></section><section class="d-none d-sm-block"><div class="card card-body mb-3 widget social"><a class=social__item href=https://github.com/villsi target=_blank rel=noopener title=GitHub><i class="bi bi-github"></i>
</a><a class=social__item href=https://twitter.com/villsi target=_blank rel=noopener title=Twitter><i class="bi bi-twitter"></i>
</a><a class=social__item href=https://steamcommunity.com/id/villsi/ target=_blank rel=noopener title=Steam><i class="bi bi-steam"></i></a></div></section><section class="d-none d-lg-block"><div class="card card-body mb-3 widget kofi"><a href=https://ko-fi.com/villsi target=_blank rel=noopener><img class="img-fluid rounded mx-auto d-block" loading=lazy src=https://img.villsi.net/2023/12/0046a7767d3b415ce9a93776641a6548.png alt=赞助图片></a></div></section><section class="d-none d-sm-block"><div class="card mb-3 categories"><div class=card-header><i class="bi bi-layers" aria-hidden=true></i>
<span class="text-uppercase fw-bold">Categories</span></div><div class=card-body><ul><li><a class="link-underline-primary link-offset-3 link-underline-opacity-0 link-underline-opacity-75-hover" href=https://blog.villsi.net/categories/blog/>Blog (1)</a></li><li><a class="link-underline-primary link-offset-3 link-underline-opacity-0 link-underline-opacity-75-hover" href=https://blog.villsi.net/categories/uncategorized/>Uncategorized (15)</a></li><li><a class="link-underline-primary link-offset-3 link-underline-opacity-0 link-underline-opacity-75-hover" href=https://blog.villsi.net/categories/%E5%8D%9A%E5%AE%A2%E8%A3%85%E4%BF%AE/>博客装修 (1)</a></li><li><a class="link-underline-primary link-offset-3 link-underline-opacity-0 link-underline-opacity-75-hover" href=https://blog.villsi.net/categories/%E8%B7%91%E5%9B%A2%E8%AE%B0%E5%BD%95/>跑团记录 (10)</a></li></ul></div></div></section><section class="d-none d-sm-block"><div class="card mb-3 widget hot_tags"><div class=card-header><i class="bi bi-tag" aria-hidden=true></i>
<span class="text-uppercase fw-bold">Tag Cloud</span></div><div class=card-body><div class=tagcloud><a href=https://blog.villsi.net/tags/blog/ title=blog class="text-muted link-underline-primary link-underline-opacity-0"><span>blog</span>
<sup><small>2</small></sup>
</a><a href=https://blog.villsi.net/tags/cloudflare/ title=Cloudflare class="text-muted link-underline-primary link-underline-opacity-0"><span>Cloudflare</span>
<sup><small>1</small></sup>
</a><a href=https://blog.villsi.net/tags/deep-learning/ title="Deep Learning" class="text-muted link-underline-primary link-underline-opacity-0"><span>Deep Learning</span>
<sup><small>1</small></sup>
</a><a href=https://blog.villsi.net/tags/dnn/ title=DNN class="text-muted link-underline-primary link-underline-opacity-0"><span>DNN</span>
<sup><small>1</small></sup>
</a><a href=https://blog.villsi.net/tags/game/ title=Game class="text-muted link-underline-primary link-underline-opacity-0"><span>Game</span>
<sup><small>1</small></sup>
</a><a href=https://blog.villsi.net/tags/github/ title=Github class="text-muted link-underline-primary link-underline-opacity-0"><span>Github</span>
<sup><small>9</small></sup>
</a><a href=https://blog.villsi.net/tags/katex/ title=Katex class="text-muted link-underline-primary link-underline-opacity-0"><span>Katex</span>
<sup><small>1</small></sup>
</a><a href=https://blog.villsi.net/tags/markdown/ title=Markdown class="text-muted link-underline-primary link-underline-opacity-0"><span>Markdown</span>
<sup><small>4</small></sup>
</a><a href=https://blog.villsi.net/tags/obsidian/ title=Obsidian class="text-muted link-underline-primary link-underline-opacity-0"><span>Obsidian</span>
<sup><small>1</small></sup>
</a><a href=https://blog.villsi.net/tags/programming/ title=Programming class="text-muted link-underline-primary link-underline-opacity-0"><span>Programming</span>
<sup><small>8</small></sup>
</a><a href=https://blog.villsi.net/tags/trpg/ title=TRPG class="text-muted link-underline-primary link-underline-opacity-0"><span>TRPG</span>
<sup><small>10</small></sup>
</a><a href=https://blog.villsi.net/tags/typora/ title=Typora class="text-muted link-underline-primary link-underline-opacity-0"><span>Typora</span>
<sup><small>1</small></sup>
</a><a href=https://blog.villsi.net/tags/%E5%86%B0%E9%A3%8E%E8%B0%B7/ title=冰风谷 class="text-muted link-underline-primary link-underline-opacity-0"><span>冰风谷</span>
<sup><small>10</small></sup>
</a><a href=https://blog.villsi.net/tags/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/ title=经验总结 class="text-muted link-underline-primary link-underline-opacity-0"><span>经验总结</span>
<sup><small>1</small></sup>
</a><a href=https://blog.villsi.net/tags/%E9%9A%8F%E6%89%8B%E6%91%98%E5%BD%95/ title=随手摘录 class="text-muted link-underline-primary link-underline-opacity-0"><span>随手摘录</span>
<sup><small>1</small></sup></a></div></div></div></section><section><div class="card card-body mb-3 widget toc markdown" id=toc-overlay><nav id=TableOfContents><ul><li><a href=#mvc-与-mvvm>MVC 与 MVVM</a></li><li><a href=#vdom>VDOM</a></li><li><a href=#组件通信>组件通信</a></li><li><a href=#响应式原理>响应式原理</a><ul><li><a href=#vue-2>Vue 2</a></li><li><a href=#vue-3>Vue 3</a></li><li><a href=#proxy-和-reflect>Proxy 和 Reflect</a></li></ul></li><li><a href=#批量更新和-nexttick>批量更新和 nextTick</a></li><li><a href=#router-模式>Router 模式</a></li><li><a href=#模板编译>模板编译</a></li><li><a href=#生命周期顺序>生命周期顺序</a></li><li><a href=#简化样例-observer>简化样例 Observer</a></li></ul></nav></div></section></aside></div></div></div></main><footer class=footer><section class=footbox><div class="container foot"><div class=copyright><p>Copyright &copy; 2018 - 2024
<a class="link-light link-underline link-underline-opacity-0" href=https://villsi.net target=_blank rel=noopener>上海红茶馆
</a>|
<a class="link-light link-underline link-underline-opacity-0" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></p></div><div class=foot_nav><nav class=navbar__bottom><ul><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a class="link-light link-underline link-underline-opacity-0" href=https://blog.villsi.net/post/>文章</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a class="link-light link-underline link-underline-opacity-0" href=https://blog.villsi.net/tagcloud/>标签</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a class="link-light link-underline link-underline-opacity-0" href=https://blog.villsi.net/code/>笔记</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a class="link-light link-underline link-underline-opacity-0" href=https://blog.villsi.net/friends/>友链</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a class="link-light link-underline link-underline-opacity-0" href=https://blog.villsi.net/echart/>关于</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a class="link-light link-underline link-underline-opacity-0" href=https://blog.villsi.net/playlist/>番剧</a></li></ul></nav></div></div></section><button class=scrollupBtn title=返回顶部>
<i class="bi bi-chevron-up"></i></button></footer></body></html>